<!DOCTYPE html>
<html lang="ja">
<head>
    <title>{{videotitle}} </title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap">
    <link rel="stylesheet" href="/css/default.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
</head>

<style>
    body {
        font-family: 'Roboto', sans-serif;
        margin: 0;
        background-color: #f0f0f0;
    }

    .container {
        width: 100%;
        max-width: 1280px;
        margin: 0 auto;
    }

    .navbar-search {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background-color: #fff;
        padding: 10px 20px;
        border-bottom: 1px solid #ddd;
    }

    .navbar-search a {
        text-decoration: none;
        color: #333;
    }

    .navbar-search img {
        width: 100px;
        height: auto;
        margin-right: 20px;
    }

    #searchbox {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 20px;
        width: 300px;
        font-size: 16px;
    }

    .bbs-button {
        padding: 8px 16px;
        background-color: #f0f0f0;
        color: #333;
        border: 1px solid #ddd;
        border-radius: 20px;
        text-decoration: none;
        display: inline-block;
        margin-right: 10px; 
        font-size: 16px;
    }

    .video-container {
        display: flex;
        margin-top: 20px;
    }

    #player-container {
        width: 60%;
        position: relative;
        margin-right: 20px;
    }

    #player {
        width: 100%;
        height: 400px;
    }

    .recommended-videos {
        width: 35%;
        display: flex;
        flex-direction: column;
    }

    .recommended-videos a {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        text-decoration: none;
        color: #333;
    }

    .recommended-videos .thumbnail {
        width: 120px;
        height: 70px;
        border-radius: 5px;
        margin-right: 10px;
    }

    .recommended-videos .thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .recommended-videos p {
        font-size: 0.9em;
        color: #333;
        margin: 0;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .video-details {
        display: flex;
        margin-top: 20px;
    }

    .video-info {
        width: 65%;
        margin-right: 20px;
    }

    .channel-profile {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        color: #606060;
    }

    .channel-profile img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
    }

    .video-info h1 {
        font-weight: 500;
        font-size: 1.5em;
        margin-bottom: 10px;
        color: #212121;
    }

    .video-info .description {
        color: #606060;
        line-height: 1.5;
    }

    .video-info hr {
        width: 100%;
        margin-bottom: 20px;
        border: 1px solid #ddd;
    }

    #comments {
        width: 100%; 
        margin-top: 20px; 
    }

    #comments .pure-g {
        border-bottom: 1px solid #ddd;
        padding: 10px 0;
    }

    #comments .channel-profile {
        margin-bottom: 5px;
    }

    #comments .channel-profile img {
        width: 40px;
        height: 40px;
    }

    #comments p {
        margin: 0;
        font-size: 14px;
    }

    #comments .pure-g p {
        margin-bottom: 5px; 
    }

    #comments .pure-g b {
        font-weight: bold;
        color: #333;
    }

    #comments .pure-g a {
        color: #007bff;
        text-decoration: none;
    }

    #comments .pure-g a:hover {
        text-decoration: underline;
    }

    /* 概要欄 */
    .video-description {
        margin-bottom: 20px;
    }

    .video-description h2 {
        font-size: 1.2em;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .video-description p {
        color: #606060;
        line-height: 1.5;
        margin-bottom: 5px;
    }

    /* レスポンシブデザインのためのメディアクエリ */
    @media (max-width: 768px) {
        .video-container {
            flex-direction: column;
        }

        #player-container {
            width: 100%;
            margin-right: 0;
        }

        .recommended-videos {
            width: 100%;
            margin-top: 10px;
        }

        .video-details {
            flex-direction: column;
        }

        .video-info {
            width: 100%;
            margin-right: 0;
        }

        #comments {
            width: 100%;
            margin-left: 0;
            margin-top: 20px;
        }
    }
</style>
</head>
<body>
    <div class="container">
        <div class="navbar-search">
            <a href="/">
                <img src="https://raw.githubusercontent.com/renrenrenrenrenrenrenrenrenren0209/eee/refs/heads/main/IMG_2141.jpeg" alt="サイトロゴ">
            </a>
            <a href="/bbs" class="bbs-button">掲示板</a>
            <form action="/search" method="get">
                <input type="search" id="searchbox" autocomplete="on" autocorrect="on" autocapitalize="none" spellcheck="false" name="q" placeholder="検索">
            </form>
        </div>

        <div class="video-container">
            <div id="player-container" class="h-box">
                <video style="outline:none;width:100%;max-height:720px !important;background-color:#000;" playsinline="" poster="{% if proxy == "True" %}/thumbnail?v={{ videoid }}{% else %}https://img.youtube.com/vi/{{ videoid }}/0.jpg{% endif
                    %}" id="player" class="on-video_player video-js player-style-invidious" controls=""
                    loadedmetadata="settime()" loop="">
                    {% for videourl in videourls%}
                    <source src="{{videourl}}">
                    {% endfor %}
                </video>
            </div>
            <div class="recommended-videos">
                <div class="recommended-videos">
                    {% for re in res %}
                    <a href="/watch?v={{ re['id'] }}">
                        <div class="thumbnail">
                            <img loading="lazy" class="thumbnail" src="{% if proxy == "True" %}/thumbnail?v={{ re['id']}}{% else %}https://img.youtube.com/vi/{{ re['id'] }}/0.jpg{% endif %}">
                        </div>
                        <p>{{re["title"]}}</p>
                    </a><br>
                    <a href="/channel/{{re['authorId']}}">{{re["author"]}}</a>{% endfor %}
                </div>
            </div>
        </div>

        <div class="video-details">
            <div class="video-info">
                <div class="h-box">
                    <a href="/channel/{{authorid}}" style="display:block;width:fit-content;width:-moz-fit-content">
                        <div class="channel-profile">
                            <img src="{{authoricon}}">
                            <span id="channel-name">{{ author }}</span>
                        </div>
                    </a>
                    <div class="video-description">
                        <h2>{{ videotitle }}</h2>
                        <p>{{ description | safe }}</p>
                        <p>投稿日時: {{ publishedAt }}</p>
                        <p>チャンネル: <a href="/channel/{{ authorid }}">{{ author }}</a></p>
                    </div>
                    <hr>
                    <div id="comments">
                        {% for comment in comments %}
                        <div class="pure-g">
                            <div class="channel-profile pure-u-4-24 pure-u-md-2-24">
                                <img loading="lazy" style="margin-right:1em;margin-top:1em;width:90%" src="{{comment["authoricon"]}}">
                            </div>
                            <div class="pure-u-30-40 pure-u-md-22-24">
                                <p><b><a class="" href="/channel/{{comment["authorid"]}}">{{comment["author"]}}</a></b></p>
                                <p style="white-space:pre-wrap">{{comment["body"] | safe}}</p>
                                <div id="replies"></div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.cookie = "yuki=True;max-age=2592000;";
        function getCookie(name) { let matches = document.cookie.match(new RegExp("(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)")); return matches ? decodeURIComponent(matches[1]) : undefined; }
        //document.getElementById("autonext").checked = getCookie("autonext");
        function checkautoplay(){document.cookie = "autonext="+document.getElementById("autonext").checked+";max-age=2592000;";}
        document.getElementById("loop").checked = getCookie("loop");
        document.getElementById("player").loop = document.getElementById("loop").checked;
        function changeloop(){document.cookie = "autonext="+document.getElementById("loop").checked+";max-age=2592000;";document.getElementById("player").loop = document.getElementById("loop").checked}
        //function sleep(waitMsec) {var startMsec = new Date();while (new Date() - startMsec < waitMsec);}
        //function autopage(){if (document.getElementById('autonext').checked) {sleep(5000);document.cookie = "autonext=true;max-age=2592000;";location.href = "/watch?v={{res[0]["id"]}}";}else{document.cookie = "autonext=false;max-age=2592000;";}}
        function getUrlQueries() { var queryStr = window.location.search.slice(1); queries = {}; queryStr.split('&').forEach(function (queryStr) { var queryArr = queryStr.split('='); queries[queryArr[0]] = queryArr[1]; }); return queries; }
        if (typeof getUrlQueries().t === "undefined") { t = 0; } else { document.getElementById("player").currentTime = getUrlQueries().t; }
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/comments?v=" + getUrlQueries().v);
        xhr.onload = function () {
            if (xhr.status != 500) {
                document.getElementById('comments').innerHTML = xhr.responseText;
            }
            else { document.getElementById('comments').innerHTML = "エラーが発生しました。再読み込みを試してください"; }
        };
        xhr.send();
        if (document.domain != "yukigennumber.ddo.jp") { document.getElementById("ads_box").innerHTML = ""; }
        document.getElementById("player").style.maxHeight = document.documentElement.clientHeight * 0.8 + "px";

        document.onkeydown = keydown;
        function keydown(key) {
            var v = document.getElementById("player");

            if (key.keyCode == 32 || key.keyCode == 75) {
                if (v.paused == true) {
                    v.play();
                } else {
                    v.pause();
                }
            }
        }
        var player = document.getElementById("player");
        var progressBarFill = document.getElementById("progress-bar-fill");
        player.addEventListener("timeupdate", function() {
            var percentage = (player.currentTime / player.duration) * 100;
            progressBarFill.style.width = percentage + "%";
        });
        function playPause() {
            if (player.paused) {
                player.play();
            } else {
                player.pause();
            }
        }
        function stopVideo() {
            player.pause();
            player.currentTime = 0;
        }
        function muteUnmute() {
            if (player.muted) {
                player.muted = false;
            } else {
                player.muted = true;
            }
        }
        function fullScreen() {
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                player.parentElement.requestFullscreen();
            }
        }
    </script>
    <script>$('#searchbox').autocomplete({
            source: function (request, response) {
                {
                    var url = "/suggest?keyword=" + request.term
                    var xhr = new XMLHttpRequest();
                    xhr.open("GET", url);
                    xhr.onload = function () {
                        response(JSON.parse(xhr.responseText));
                    }
                    xhr.send();
                }
            }, delay: 300
        });</script>
</body>

</html>
