<!DOCTYPE html>
<html lang="ja">
<head>
    <title>{{videotitle}} </title>
    <link rel="stylesheet" href="/css/pure-min.css">
    <link rel="stylesheet" href="/css/grids-responsive-min.css">
    <link rel="stylesheet" href="/css/ionicons.min.css">
    <link rel="stylesheet" href="/css/default.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
</head>

  <style>
    .container {
      width: 100%;
      background-color: #fff; 
      padding: 0px; 
      text-align: center; 
    }
    .navbar-search {
      display: flex; 
      align-items: center; 
      justify-content: space-around; 
      background-color: #fff; 
      padding: 13px; 
      border-radius: 5px; 
      box-shadow: 0 30px 100px rgba(0, 0, 0, 0.1); 
      width: 100%; 
      margin: 0 auto; 
    }
    #searchbox {
      padding: 15px;
      border: 1px solid #ddd; 
      border-radius: 100000px; 
      width: 450px; 
    }
    .bbs-button {
      padding: 10px 20px;
      background-color: #808080; 
      color: white;
      border: none;
      border-radius: 5px;
      text-decoration: none;
      display: inline-block;
      margin-right: 10px; 
    }
    .video-container {
      display: flex;
      justify-content: space-between;
      gap: 20px;
    }
    #player-container {
      width: 60%;
      position: relative; /* Add position: relative to the player-container */
    }
    .recommended-videos {
      width: 35%;
    }
    .thumbnail {
      width: 100%;
      height: auto;
    }
    .video-info {
      margin-top: 20px;
    }
    #progress-bar {
      width: 100%;
      height: 5px;
      background-color: #ddd;
      border-radius: 5px;
      position: absolute; /* Position the progress bar absolutely */
      bottom: 10px; /* Position it below the video */
      left: 0; /* Align it to the left */
      z-index: 1; /* Ensure it's above the video */
      cursor: pointer; /* Add cursor: pointer for better user experience */
    }
    #progress-bar-fill {
      height: 100%;
      background-color: #808080;
      border-radius: 5px;
      width: 0%;
      transition: width 0.3s ease;
    }
    #player {
      /* Style the video player to resemble YouTube */
      width: 100%;
      height: auto;
    }
    .video-info {
      /* Style the video information section */
      margin-top: 10px;
    }
    .video-info h1 {
      /* Style the video title */
      font-size: 1.5em;
      margin-bottom: 10px;
    }
    .channel-profile {
      /* Style the channel profile */
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .channel-profile img {
      /* Style the channel icon */
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
    }
    .channel-profile span {
      /* Style the channel name */
      font-weight: bold;
    }
    .description {
      /* Style the video description */
      margin-bottom: 10px;
    }
    .recommended-videos {
      /* Style the recommended videos section */
      margin-top: 20px;
    }
    .recommended-videos .thumbnail {
      /* Style the thumbnail images */
      width: 100%;
      height: auto;
      margin-bottom: 5px;
    }
    .recommended-videos p {
      /* Style the video titles */
      margin-bottom: 10px;
    }
    .control-buttons {
      /* Style the control buttons */
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .control-button {
      /* Style the individual control buttons */
      padding: 5px 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="navbar-search">
      <a href="/"> 
        <p style="text-align:left; margin-right: 10px;">
          <img src="https://raw.githubusercontent.com/renrenrenrenrenrenrenrenrenren0209/eee/refs/heads/main/IMG_2141.jpeg" width="130">
        </p> 
      </a>
      <a href="/bbs" class="bbs-button">掲示板</a>
      <form action="/search" method="get">
        <input type="search" id="searchbox" autocomplete="on" autocorrect="on" autocapitalize="none" spellcheck="false" name="q" placeholder="検索">
      </form>
    </div>
  </div>
  <div class="video-container">
    <div id="player-container" class="h-box">
        <video style="outline:none;width:100%;max-height:720px !important;background-color:#000;" playsinline="" poster="{% if proxy == "True" %}/thumbnail?v={{ videoid }}{% else %}https://img.youtube.com/vi/{{ videoid }}/0.jpg{% endif
            %}" id="player" class="on-video_player video-js player-style-invidious" controls=""
            loadedmetadata="settime()" loop="">
            {% for videourl in videourls%}
            <source src="{{videourl}}">
            {% endfor %}
        </video>
        <div id="progress-bar">
            <div id="progress-bar-fill"></div>
        </div>
    </div>
    <div class="recommended-videos">
        <div class="video-info">
            <h1>{{ videotitle }}</h1>
            <div class="channel-profile">
                <img src="{{authoricon}}">
                <span id="channel-name">{{ author }}</span>
            </div>
            <div class="description">
                <div id="descriptionWrapper">{{ description | safe}}</div>
            </div>
            <hr>
            <div id="comments">
            </div>
            <hr>
            <!--自動再生<input type="checkbox" id="autonext" onchange="checkautoplay()"><br>-->
            ループ再生<input type="checkbox" id="loop" onchange="changeloop()">
        </div>
        <div class="recommended-videos">
            {% for re in res %}
            <a href="/watch?v={{ re['id'] }}">
                <div class="thumbnail">
                    <img loading="lazy" class="thumbnail" src="{% if proxy == "True" %}/thumbnail?v={{ re['id']}}{% else %}https://img.youtube.com/vi/{{ re['id'] }}/0.jpg{% endif %}">
                </div>
                <p>{{re["title"]}}</p>
            </a><br>
            <a href="/channel/{{re['authorId']}}">{{re["author"]}}</a>{% endfor %}
        </div>
    </div>
  </div>
    <div class="pure-u-1 pure-u-md-2-24"></div>
    <script>
        document.cookie = "yuki=True;max-age=2592000;";
        function getCookie(name) { let matches = document.cookie.match(new RegExp("(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)")); return matches ? decodeURIComponent(matches[1]) : undefined; }
        //document.getElementById("autonext").checked = getCookie("autonext");
        function checkautoplay(){document.cookie = "autonext="+document.getElementById("autonext").checked+";max-age=2592000;";}
        document.getElementById("loop").checked = getCookie("loop");
        document.getElementById("player").loop = document.getElementById("loop").checked;
        function changeloop(){document.cookie = "autonext="+document.getElementById("loop").checked+";max-age=2592000;";document.getElementById("player").loop = document.getElementById("loop").checked}
        //function sleep(waitMsec) {var startMsec = new Date();while (new Date() - startMsec < waitMsec);}
        //function autopage(){if (document.getElementById('autonext').checked) {sleep(5000);document.cookie = "autonext=true;max-age=2592000;";location.href = "/watch?v={{res[0]["id"]}}";}else{document.cookie = "autonext=false;max-age=2592000;";}}
        function getUrlQueries() { var queryStr = window.location.search.slice(1); queries = {}; queryStr.split('&').forEach(function (queryStr) { var queryArr = queryStr.split('='); queries[queryArr[0]] = queryArr[1]; }); return queries; }
        if (typeof getUrlQueries().t === "undefined") { t = 0; } else { document.getElementById("player").currentTime = getUrlQueries().t; }
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/comments?v=" + getUrlQueries().v);
        xhr.onload = function () {
            if (xhr.status != 500) {
                document.getElementById('comments').innerHTML = xhr.responseText;
            }
            else { document.getElementById('comments').innerHTML = "エラーが発生しました。再読み込みを試してください"; }
        };
        xhr.send();
        if (document.domain != "yukigennumber.ddo.jp") { document.getElementById("ads_box").innerHTML = ""; }
        document.getElementById("player").style.maxHeight = document.documentElement.clientHeight * 0.8 + "px";

        document.onkeydown = keydown;
        function keydown(key) {
            var v = document.getElementById("player");

            if (key.keyCode == 32 || key.keyCode == 75) {
                if (v.paused == true) {
                    v.play();
                } else {
                    v.pause();
                }
            }
        }
        var player = document.getElementById("player");
        var progressBarFill = document.getElementById("progress-bar-fill");
        player.addEventListener("timeupdate", function() {
            var percentage = (player.currentTime / player.duration) * 100;
            progressBarFill.style.width = percentage + "%";
        });
        function playPause() {
            if (player.paused) {
                player.play();
            } else {
                player.pause();
            }
        }
        function stopVideo() {
            player.pause();
            player.currentTime = 0;
        }
        function muteUnmute() {
            if (player.muted) {
                player.muted = false;
            } else {
                player.muted = true;
            }
        }
        function fullScreen() {
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                player.parentElement.requestFullscreen();
            }
        }
    </script>
    <script>$('#searchbox').autocomplete({
            source: function (request, response) {
                {
                    var url = "/suggest?keyword=" + request.term
                    var xhr = new XMLHttpRequest();
                    xhr.open("GET", url);
                    xhr.onload = function () {
                        response(JSON.parse(xhr.responseText));
                    }
                    xhr.send();
                }
            }, delay: 300
        });</script>
</body>

</html>
